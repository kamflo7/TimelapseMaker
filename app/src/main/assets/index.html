<html>
	<head>
		<title>TimelapseMaker HTTP Server v1</title>
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script type="text/javascript">
			var repeatTime = 3000;
			var number = 0;
		
			$(document).ready(function() {
				$("#resultIp").html(
					"Pathname: " + window.location.pathname +
					"<br />Url: " + window.location.href
				);
				
				repeat();
			
				$("#btn").click(function() {
					$.ajax({
							url: getBaseHref()+'pokemon.api',
							success: function(html) {
								$("#result").html("Your pokemon: " + html);
							}
					});
				});
			});
			
			function log(msg) {
				$("#resultSocket").append(msg+"<br />");
			}
			
			function getBaseHref() {
				return "http://" + window.location.hostname + ":8080/";
			}
			
			function repeat() {
				$.ajax({
							url: getBaseHref()+'pokemon.api',
							success: function(html) {
								/*$("#result").html("[" + (number++) + "] Your pokemon: " + html);*/
								
								/*
								batteryProgressVal 150px max
								batteryTxtVal
								captured
								frequency
								remainingTime
								progressTotal 350px max
								lastPhoto
								*/

								var json = JSON.parse(html);
								
								$("#batteryProgressVal").css("width", ((json.battery_level / 100) * 150) + "px");
								$("#batteryTxtVal").html(json.battery_level + "%");
								$("#captured").html("Captured "+json.captured_photos+"/"+json.total_photos+" photos");
								$("#frequency").html("Each image is captured every "+json.frequency+" sec (+3sec autofocus)");
								
								var sec = json.estimated_time;
								var minutes = Math.floor(sec/60);
								sec = sec % 60;
								
								$("#remainingTime").html("Estimated remaining time: "+minutes+" minutes "+sec+" seconds");
								$("#progressTotal").css("width", ((json.captured_photos / json.total_photos) * 350) + "px");
								
								if(json.photo_base64) {
									$("#lastPhoto").attr("src", "data:image/png;base64," + json.photo_base64);
								}
								
								setTimeout("repeat()", repeatTime);
							}
					});
			}
		</script>
		<style>
			.battery {
				border: 0px solid red;
				width: 163px;
				height: 47px;
			}
			.batteryIn {
				width: 150px;
				height: 45px;
				border: 1px solid black;
				position: absolute;
			}
			.batteryStick {
				width: 10px;
				height: 15px;
				border: 1px solid black;
				position: absolute;
				margin-left: 151px;
				margin-top: 0px;
			}
			.batteryProgress {
				position: absolute;
				height: 45px;
				width: 50px;
				background-color: yellow;
			}
			.batteryText {
				position: absolute;
				z-index: 5;
				left: 50%;
				margin-left: -10px;
				margin-top: 10px;
			}
			.item {
				margin-top: 10px;
				display: flex;
				align-items: center; /* align vertical */
			}
			span {
				font-family: 'Calibri';
				margin-left: 5px;
			}
			.progressContainer {
				margin-left: 5px;
				width: 350px;
				border: 1px ridge gray;
				height: 30px;
			}
			.progressValue {
				position: absolute;
				height: 30px;
				background-color: #DCFF00;
				width: 0px;
			}
			.header {
				width: 500px;
				height: 80px;
			}
		</style>
	</head>
	<body>
	<!--
		batteryProgressVal
		batteryTxtVal
		captured
		frequency
		remainingTime
		progressTotal
		lastPhoto
	-->
		<div class="header">
			<img src="my_icon.png" height="70" style="position: absolute"/>
			<div style="width: 200px; position: absolute; margin-left: 80px; font-size: 30px; font-family: 'Calibri';">Timelapse Maker</div>
			
		</div>
		<div class="battery item">
			<div class="batteryIn"><div id="batteryTxtVal" class="batteryText">67%</div><div id="batteryProgressVal" class="batteryProgress"></div></div>
			<div class="batteryStick"></div>
		</div>
		<div class="item"><img src="camera.png" width="50"/><span id="captured">Captured 30/720 photos</span></div>
		<div class="item"><img src="frequency.png" width="50"/><span id="frequency">Each image is captured every 7 sec (+3sec autofocus)</span></div>
		<div class="item"><img src="clock.png" width="50"/><span id="remainingTime">Estimated remaining time: 37 minutes 25 seconds</span></div>
		<div class="item"><img src="progress.png" width="50"/><div class="progressContainer"><div id="progressTotal" class="progressValue"></div></div></div>
		<img width="500" src="no_image.png" id="lastPhoto" />
	</body>
</html>